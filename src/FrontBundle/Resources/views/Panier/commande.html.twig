{% extends 'base.html.twig' %}

{% block body %}
    <section id="page-content" class="page-wrapper">
        <!-- Start checkout Area -->
        <div class="checkout-area section-padding">
            <div class="container">
                <div class="row">

                    <div class="col-md-6">
                        <div class="order-info azure-bg p-30">
                            <div class="billing-title text-uppercase mb-15">
                                <h5><strong>your order</strong></h5>
                            </div>
                            <table>
                                <tbody>
                                {% for p in produits %}
                                <tr>
                                    <th>{{ p.libelleP }}</th>
                                    <td>{{ p.PrixVente }} TND</td>
                                </tr>
                                {% endfor %}
                                <tr class="old-price">
                                    <th>Order Total</th>
                                    <td>{{ total }}TND</td>
                                </tr>
                                {% if totalReduit is defined %}
                                    <tr class="total">
                                        <th>Reduction value</th>
                                        <td>{{ couponValue }}%</td>
                                    </tr>
                                    <tr class="total">
                                        <th>New Total</th>
                                        <td>{{ totalReduit }}TND</td>
                                    </tr>
                                {% endif  %}
                                </tbody>
                            </table>

                            <div class="billing-title text-uppercase mt-40 pb-30">
                                <h5><strong>payment method</strong></h5>
                            </div>
                            <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                                <div class="panel panel-default">
                                    <div class="panel-heading" role="tab" id="headingOne">
                                        <h4 class="panel-title text-uppercase">
                                            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                                Credit Card Payment
                                            </a>
                                        </h4>
                                    </div>
                                    <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                                        <div class="panel-body">
                                            <script src="https://js.stripe.com/v3/"></script>

                                            <form action="{{ path('payer',{'total':total}) }}" method="post" id="payment-form">
                                                <div class="form-row">

                                                    <div id="card-element">
                                                        <!-- A Stripe Element will be inserted here. -->
                                                    </div>

                                                    <!-- Used to display Element errors. -->
                                                    <div id="card-errors" role="alert"></div>
                                                </div>
<br>
                                                <button class="button extra-small">Submit Payment </button>
                                            </form>
                                            <script>
                                                var stripe = Stripe('pk_test_SwEiHkJiJHtohdFPEVeMkwXi00xrvXCpPF');
                                                var elements = stripe.elements();
                                                var style = {
                                                    base: {
                                                        // Add your base input styles here. For example:
                                                        fontSize: '16px',
                                                        color: '#32325d',
                                                    },
                                                };

                                                // Create an instance of the card Element.
                                                var card = elements.create('card', {style: style});

                                                // Add an instance of the card Element into the `card-element` <div>.
                                                card.mount('#card-element');
                                                // Create a token or display an error when the form is submitted.
                                                var form = document.getElementById('payment-form');
                                                form.addEventListener('submit', function(event) {
                                                    event.preventDefault();

                                                    stripe.createToken(card).then(function(result) {
                                                        if (result.error) {
                                                            // Inform the customer that there was an error.
                                                            var errorElement = document.getElementById('card-errors');
                                                            errorElement.textContent = result.error.message;
                                                        } else {
                                                            // Send the token to your server.
                                                            stripeTokenHandler(result.token);
                                                        }
                                                    });
                                                });
                                                function stripeTokenHandler(token) {
                                                    // Insert the token ID into the form so it gets submitted to the server
                                                    var form = document.getElementById('payment-form');
                                                    var hiddenInput = document.createElement('input');
                                                    hiddenInput.setAttribute('type', 'hidden');
                                                    hiddenInput.setAttribute('name', 'stripeToken');
                                                    hiddenInput.setAttribute('value', token.id);
                                                    form.appendChild(hiddenInput);

                                                    // Submit the form
                                                    form.submit();
                                                }

                                            </script>

                                            {% block javascript %}
                                            {% endblock %}

                                        </div>
                                    </div>
                                </div>
                                <div class="panel panel-default">
                                    <div class="panel-heading" role="tab" id="headingTwo">
                                        <h4 class="panel-title text-uppercase">
                                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                                Payment A la livraison
                                            </a>
                                        </h4>
                                    </div>
                                    <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                                        <div class="panel-body">
                                            S'il vous plait , veuillez apporter le montant exact de votre commande.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <a title="Add to Cart" href="{{ path('afficher_produitF') }}" class="button extra-small">
                                <span>place order</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Of checkout Area -->

        <!-- Start Brand Area -->
        <div class="brand-area pb-90">
            <div class="container">
                <div class="row">
                    <div class="brand-list">
                        <div class="col-md-12">
                            <div class="single-brand text-center">
                                <a href="#">
                                    <img src="images/brand/1.png" alt="">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="single-brand text-center">
                                <a href="#">
                                    <img src="images/brand/2.png" alt="">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="single-brand text-center">
                                <a href="#">
                                    <img src="images/brand/3.png" alt="">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="single-brand text-center">
                                <a href="#">
                                    <img src="images/brand/4.png" alt="">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="single-brand text-center">
                                <a href="#">
                                    <img src="images/brand/5.png" alt="">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="single-brand text-center">
                                <a href="#">
                                    <img src="images/brand/6.png" alt="">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="single-brand text-center">
                                <a href="#">
                                    <img src="images/brand/1.png" alt="">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="single-brand text-center">
                                <a href="#">
                                    <img src="images/brand/2.png" alt="">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="single-brand text-center">
                                <a href="#">
                                    <img src="images/brand/3.png" alt="">
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Of Brand Area -->
        <!-- Start Newsletter Area -->
        <div class="newsletter-area">
            <div class="container">
                <div class="row">
                    <div class="newsletter-content default-bg clearfix ptb-40">
                        <div class="col-md-offset-2 col-md-3 col-sm-5">
                            <div class="newsletter-title text-white text-uppercase">
                                <h4>NewsLetter Sign-Up</h4>
                            </div>
                        </div>
                        <div class="col-md-5 col-sm-7">
                            <div class="signup-form">
                                <form class="news-form" action="#">
                                    <input type="text" placeholder="Enter your email address..." class="f-form">
                                    <button class="submit text-uppercase">subscribe</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Of Newsletter Area -->
    </section>
{% endblock %}