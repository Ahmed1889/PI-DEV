{% extends 'base2.html.twig' %}



{% block notif %}

    {{ mgilet_notification_count(app.user) }}
    {{ mgilet_notification_render(app.user) }}
{% endblock %}
{% block body %}
    <ul class="navbar-nav float-right">
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle waves-effect waves-dark" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <span class="fas fa-bell" style="color: green">{{ mgilet_notification_count(app.user) }}</span></i>
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown" style="float: right">

            {{ mgilet_notification_render(app.user) }}<br>

        </div>
    </li>
    </ul>
    <h1>Depots list</h1>
    <span id='p' style="color: #1c7430"></span>

    <div align="right">
        <a href="{{ path('depot_index') }}" class=" fas fa-redo"></a>
    </div>
    <table class="table table-striped table-bordered dataTable" id="zero_config">
        <thead>
            <tr>

                <th id="n">Nom</th>
                <th >Addresse</th>
                <th id="c">Capacite</th>
                <th id="d">Disponibilite</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for depot in depots %}
            <tr>

                <td>{{ depot.nom }}</td>
                <td>{{ depot.addresse }}</td>
                <td>{{ depot.capacite }}</td>
                <td>{% if depot.disponibilite %}<span class="text-success">Disponible</span>{% else %}<span class="text-danger">Inemployable</span>{% endif %}</td>

                <td>
                          <a href="{{ path('depot_show', { 'id': depot.id }) }}" class="fas fa-eye"></a>

                    {#{{ render(controller('BackBundle:Depot:edit',{'id':depot.id})) }}
                    <button href="" class="fas fa-wrench" data-toggle="modal" data-target="#dataModal{{ depot.id }}" id="i"></button>#}
                        <a href="{{ path('depot_edit', { 'id': depot.id }) }}" class="fas fa-wrench" ></a>
                </td>
            </tr>
        {% endfor %}




        </tbody>
    </table>
    <p id="p"></p>
{#


#}








   {# <ul>
        <li>
            <a href="{{ path('depot_new') }}">Create a new depot</a>
        </li>
    </ul>
    #}
{% endblock %}
{% block js2 %}
    <script src="{{ asset('jquery-3.4.1.min.js') }}"></script>
    <script language = "javascript">

        $(document).ready(function(){



            $("#n").on("click",function(event){

                // $r=$("#recherche").val();
                $.ajax({
                    url:        "{{ path('filterN')}}",
                    type:       'POST',
                    dataType:   'json',
                    async:      true,

                    success: function(data) {
                        console.log(data);

                        var table = $('#zero_config');
                        table.html('');
                        var table_head = $('<tr>');

                        table_head.append($('<th id="n"> ').text('Nom'))
                        table_head.append($('<th>').text('Addresse'))
                        table_head.append($('<th id="c">').text('Capacite'))
                        table_head.append($('<th>').text('Disponibilite'))
                        table_head.append($('<th>').text('Action'))
                        table.append(table_head);

                        /*
                        var e=$('<tr>' +
                            '<th>Nom</th>' +
                            '<th>Prenom</th>' +
                            '<th>Email</th>' +
                            '<th>Addresse</th>' +
                            '<th>Addresse</th>' +
                            '</tr>');
                           */

                        for(var x in data){
                            var tr = $('<tr>');

                            tr.append($('<td>').text(data[x].nom));
                            tr.append($('<td>').text(data[x].addresse));
                            tr.append($('<td>').text(data[x].capacite));
                            tr.append($('<td>').text(data[x].disponibilite));
                            tr.append($('<td><a id="show" class="fas fa-eye" href="'+data[x].id+'/show"></a><a id="edit" class="fas fa-wrench" href="'+data[x].id +'/edit"></a>'));
                            table.append(tr);

                        };

                        $("#c").on("click",function(event){

                            // $r=$("#recherche").val();
                            $.ajax({
                                url:        "{{ path('filterC')}}",
                                type:       'POST',
                                dataType:   'json',
                                async:      true,

                                success: function(data) {
                                    console.log(data);

                                    var table = $('#zero_config');
                                    table.html('');
                                    var table_head = $('<tr>');

                                    table_head.append($('<th id="n">').text('Nom'))
                                    table_head.append($('<th>').text('Addresse'))
                                    table_head.append($('<th id="c">').text('Capacite'))
                                    table_head.append($('<th>').text('Disponibilite'))
                                    table_head.append($('<th>').text('Action'))
                                    table.append(table_head);

                                    /*
                                    var e=$('<tr>' +
                                        '<th>Nom</th>' +
                                        '<th>Prenom</th>' +
                                        '<th>Email</th>' +
                                        '<th>Addresse</th>' +
                                        '<th>Addresse</th>' +
                                        '</tr>');
                                       */

                                    for(var x in data){
                                        var tr = $('<tr>');

                                        tr.append($('<td>').text(data[x].nom));
                                        tr.append($('<td>').text(data[x].addresse));
                                        tr.append($('<td>').text(data[x].capacite));
                                        tr.append($('<td>').text(data[x].disponibilite));
                                        tr.append($('<td><a id="show" class="fas fa-eye" href="'+data[x].id+'/show"></a><a id="edit" class="fas fa-wrench" href="'+data[x].id +'/edit"></a>'));
                                        table.append(tr);
                                    };


                                },
                                error : function(xhr, textStatus, errorThrown) {
                                    alert('Ajax request failed.');
                                }
                            });

                        });

                    },
                    error : function(xhr, textStatus, errorThrown) {
                        alert('Ajax request failed.');
                    }
                });

            });
            $("#c").on("click",function(event){

                // $r=$("#recherche").val();
                $.ajax({
                    url:        "{{ path('filterC')}}",
                    type:       'POST',
                    dataType:   'json',
                    async:      true,

                    success: function(data) {
                        console.log(data);

                        var table = $('#zero_config');
                        table.html('');
                        var table_head = $('<tr>');

                        table_head.append($('<th id="n"> ').text('Nom'))
                        table_head.append($('<th>').text('Addresse'))
                        table_head.append($('<th id="c">').text('Capacite'))
                        table_head.append($('<th>').text('Disponibilite'))
                        table_head.append($('<th>').text('Action'))
                        table.append(table_head);

                        /*
                        var e=$('<tr>' +
                            '<th>Nom</th>' +
                            '<th>Prenom</th>' +
                            '<th>Email</th>' +
                            '<th>Addresse</th>' +
                            '<th>Addresse</th>' +
                            '</tr>');
                           */

                        for(var x in data){
                            var tr = $('<tr>');

                            tr.append($('<td>').text(data[x].nom));
                            tr.append($('<td>').text(data[x].addresse));
                            tr.append($('<td>').text(data[x].capacite));
                            tr.append($('<td>').text(data[x].disponibilite));
                            tr.append($('<td><a id="show" class="fas fa-eye" href="'+data[x].id+'/show"></a><a id="edit" class="fas fa-wrench" href="'+data[x].id +'/edit"></a>'));
                            table.append(tr);

                        };

                        $("#n").on("click",function(event){

                            // $r=$("#recherche").val();
                            $.ajax({
                                url:        "{{ path('filterN')}}",
                                type:       'POST',
                                dataType:   'json',
                                async:      true,

                                success: function(data) {
                                    console.log(data);

                                    var table = $('#zero_config');
                                    table.html('');
                                    var table_head = $('<tr>');

                                    table_head.append($('<th id="n">').text('Nom'))
                                    table_head.append($('<th>').text('Addresse'))
                                    table_head.append($('<th id="c">').text('Capacite'))
                                    table_head.append($('<th>').text('Disponibilite'))
                                    table_head.append($('<th>').text('Action'))
                                    table.append(table_head);

                                    /*
                                    var e=$('<tr>' +
                                        '<th>Nom</th>' +
                                        '<th>Prenom</th>' +
                                        '<th>Email</th>' +
                                        '<th>Addresse</th>' +
                                        '<th>Addresse</th>' +
                                        '</tr>');
                                       */

                                    for(var x in data){
                                        var tr = $('<tr>');

                                        tr.append($('<td>').text(data[x].nom));
                                        tr.append($('<td>').text(data[x].addresse));
                                        tr.append($('<td>').text(data[x].capacite));
                                        tr.append($('<td>').text(data[x].disponibilite));
                                        tr.append($('<td><a id="show" class="fas fa-eye" href="'+data[x].id+'/show"></a><a id="edit" class="fas fa-wrench" href="'+data[x].id +'/edit"></a>'));
                                        table.append(tr);
                                    };


                                },
                                error : function(xhr, textStatus, errorThrown) {
                                    alert('Ajax request failed.');
                                }
                            });

                        });

                    },
                    error : function(xhr, textStatus, errorThrown) {
                        alert('Ajax request failed.');
                    }
                });

            });
            $.ajax({
                url:        "{{ path('count')}}",
                type:       'POST',
                dataType:   'json',
                async:      true,

                success: function(data) {
                    console.log(data);
                    // alert(data.count)
                    var count = $('#p');

                    count.html("<span id='p'>Vous avez "+data.count+" depot(s) disponible</span>");
                    $("#p").show();
                    $("#p").fadeOut(20000);

                    $("#c").on("click",function(event){

                        // $r=$("#recherche").val();
                        $.ajax({
                            url:        "{{ path('filterC')}}",
                            type:       'POST',
                            dataType:   'json',
                            async:      true,

                            success: function(data) {
                                console.log(data);

                                var table = $('#zero_config');
                                table.html('');
                                var table_head = $('<tr>');

                                table_head.append($('<th id="n">').text('Nom'))
                                table_head.append($('<th>').text('Addresse'))
                                table_head.append($('<th id="c">').text('Capacite'))
                                table_head.append($('<th>').text('Disponibilite'))
                                table_head.append($('<th>').text('Action'))
                                table.append(table_head);

                                /*
                                var e=$('<tr>' +
                                    '<th>Nom</th>' +
                                    '<th>Prenom</th>' +
                                    '<th>Email</th>' +
                                    '<th>Addresse</th>' +
                                    '<th>Addresse</th>' +
                                    '</tr>');
                                   */

                                for(var x in data){
                                    var tr = $('<tr>');

                                    tr.append($('<td>').text(data[x].nom));
                                    tr.append($('<td>').text(data[x].addresse));
                                    tr.append($('<td>').text(data[x].capacite));
                                    tr.append($('<td>').text(data[x].disponibilite));
                                    tr.append($('<td><a id="show" class="fas fa-eye" href="'+data[x].id+'/show"></a><a id="edit" class="fas fa-wrench" href="'+data[x].id +'/edit"></a>'));
                                    table.append(tr);
                                };


                            },
                            error : function(xhr, textStatus, errorThrown) {
                                alert('Ajax request failed.');
                            }
                        });

                    });

                },
                error : function(xhr, textStatus, errorThrown) {
                    alert('Ajax request failed.');
                }
            });

        });
        $('#i').load('/index.html.twig');

    </script>
{% endblock %}